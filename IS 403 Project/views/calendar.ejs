<%- include('partials/header', {pageTitle: 'Calendar - Cal-Endure to the End'}) %>
<body class="app-page">
    <%- include('partials/app-navbar', {currentPage: 'calendar'}) %>

    <!-- Main Content -->
    <main class="app-main">
        <div class="app-container">
            <!-- Page Header -->
            <header class="page-header">
                <div>
                    <h1 class="page-title">Calendar</h1>
                    <p class="page-subtitle">Plan every hour of your day</p>
                </div>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="goToToday()">Today</button>
                    <button class="btn-primary" onclick="openAddEventModal()">
                        <span>+ Add Event</span>
                    </button>
                </div>
            </header>

            <!-- Calendar Controls -->
            <div class="calendar-controls">
                <div class="calendar-nav">
                    <button class="btn-icon" onclick="navigatePrevious()">‚óÄ</button>
                    <h2 id="current-month">February 2025</h2>
                    <button class="btn-icon" onclick="navigateNext()">‚ñ∂</button>
                </div>
                <div class="calendar-view-toggle">
                    <button class="view-btn <%= currentView === 'month' ? 'active' : '' %>" data-view="month" onclick="switchView('month')">Month</button>
                    <button class="view-btn <%= currentView === 'week' ? 'active' : '' %>" data-view="week" onclick="switchView('week')">Week</button>
                    <button class="view-btn <%= currentView === 'day' ? 'active' : '' %>" data-view="day" onclick="switchView('day')">Day</button>
                </div>
            </div>

            <!-- Calendar Grid - Month View -->
            <div id="month-view" class="calendar-container" style="<%= currentView !== 'month' ? 'display: none;' : '' %>">
                <div class="calendar-weekdays">
                    <div class="weekday">Sunday</div>
                    <div class="weekday">Monday</div>
                    <div class="weekday">Tuesday</div>
                    <div class="weekday">Wednesday</div>
                    <div class="weekday">Thursday</div>
                    <div class="weekday">Friday</div>
                    <div class="weekday">Saturday</div>
                </div>
                <div class="calendar-days" id="calendar-days">
                    <!-- Days will be generated by JavaScript -->
                </div>
            </div>

            <!-- Week View -->
            <div id="week-view" class="calendar-container" style="<%= currentView !== 'week' ? 'display: none;' : '' %>">
                <div class="week-grid">
                    <div class="week-time-column">
                        <div class="week-header-spacer"></div>
                        <% for (let hour = 6; hour <= 22; hour++) { %>
                            <div class="time-slot"><%= hour > 12 ? (hour - 12) + 'PM' : (hour === 12 ? '12PM' : hour + 'AM') %></div>
                        <% } %>
                    </div>
                    <% const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']; %>
                    <% for (let i = 0; i < 7; i++) { %>
                        <div class="week-day-column" data-day-index="<%= i %>">
                            <div class="week-day-header"><%= dayNames[i] %></div>
                            <div class="week-day-events" ondrop="dropEventWeek(event, <%= i %>)" ondragover="allowDrop(event)">
                                <!-- Events will be positioned here -->
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Day View -->
            <div id="day-view" class="calendar-container" style="<%= currentView !== 'day' ? 'display: none;' : '' %>">
                <div class="day-grid">
                    <div class="day-header-info">
                        <h3 id="day-view-date"></h3>
                    </div>
                    <div class="day-schedule">
                        <% for (let hour = 6; hour <= 22; hour++) { %>
                            <div class="day-hour-row">
                                <div class="day-hour-label"><%= hour > 12 ? (hour - 12) + 'PM' : (hour === 12 ? '12PM' : hour + 'AM') %></div>
                                <div class="day-hour-events" data-hour="<%= hour %>" ondrop="dropEventDay(event, <%= hour %>)" ondragover="allowDrop(event)">
                                    <!-- Events for this hour -->
                                </div>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <!-- Today's Schedule -->
            <div class="todays-schedule">
                <h3>Today's Schedule</h3>
                <div class="schedule-list" id="todays-events">
                    <% if (typeof todayEvents !== 'undefined' && todayEvents.length > 0) { %>
                        <% todayEvents.forEach(function(event) { %>
                            <div class="schedule-event <%= event.event_type ? event.event_type.toLowerCase() : 'spiritual' %>" draggable="true" ondragstart="dragEvent(event)" data-event-id="<%= event.event_id %>">
                                <div class="event-time-badge"><%= event.start_time ? event.start_time.substring(0, 5) : '' %></div>
                                <div class="event-details">
                                    <div class="event-title"><%= event.title %></div>
                                    <div class="event-meta">
                                        <span class="event-type">
                                            <% if (event.event_type === 'Spiritual') { %>‚úùÔ∏è
                                            <% } else if (event.event_type === 'Social') { %>üë•
                                            <% } else if (event.event_type === 'Intellectual') { %>üìö
                                            <% } else if (event.event_type === 'Physical') { %>üí™
                                            <% } else if (event.event_type === 'Romantic') { %>‚ù§Ô∏è
                                            <% } %> <%= event.event_type %>
                                        </span>
                                        <% if (event.contacts && event.contacts.length > 0) { %>
                                            <span class="event-contact"><%= event.contacts[0].first_name %> <%= event.contacts[0].last_name %></span>
                                        <% } else { %>
                                            <span class="event-contact">Personal</span>
                                        <% } %>
                                    </div>
                                </div>
                                <div class="event-actions">
                                    <button type="button" class="btn-icon-small" onclick="editEvent(<%= event.event_id %>)">‚úèÔ∏è</button>
                                    <form action="/calendar/delete/<%= event.event_id %>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this event?')">
                                        <button type="submit" class="btn-icon-small">üóëÔ∏è</button>
                                    </form>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="schedule-event" style="justify-content: center;">
                            <p style="color: #697268; font-style: italic;">No events scheduled for today. Click + Add Event to create one!</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </main>

    <!-- Add/Edit Event Modal -->
    <div id="event-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="event-modal-title">Add New Event</h2>
                <button class="modal-close" onclick="closeEventModal()">&times;</button>
            </div>
            <form id="event-form" class="modal-form" action="/calendar/create" method="POST">
                <input type="hidden" id="event-id" name="eventId" value="">

                <div class="form-row">
                    <div class="form-group">
                        <label for="event-title">Event Title</label>
                        <input type="text" id="event-title" name="title" placeholder="What's happening?" required>
                    </div>
                    <div class="form-group">
                        <label for="event-type">Event Type</label>
                        <select id="event-type" name="eventType" required>
                            <option value="">Select type...</option>
                            <option value="Spiritual">‚úùÔ∏è Spiritual</option>
                            <option value="Social">üë• Social</option>
                            <option value="Intellectual">üìö Intellectual</option>
                            <option value="Physical">üí™ Physical</option>
                            <option value="Romantic">‚ù§Ô∏è Romantic</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="event-date">Date</label>
                        <input type="date" id="event-date" name="eventDate" required>
                    </div>
                    <div class="form-group">
                        <label for="event-start-time">Start Time</label>
                        <input type="time" id="event-start-time" name="startTime" required>
                    </div>
                    <div class="form-group">
                        <label for="event-end-time">End Time</label>
                        <input type="time" id="event-end-time" name="endTime">
                    </div>
                </div>

                <div class="form-group">
                    <label for="event-location">Location (Optional)</label>
                    <input type="text" id="event-location" name="location" placeholder="Where is this happening?">
                </div>

                <div class="form-group">
                    <label for="event-contacts">Attach Contacts</label>
                    <select id="event-contacts" name="contacts" multiple class="multi-select">
                        <% if (typeof contacts !== 'undefined' && contacts.length > 0) { %>
                            <% contacts.forEach(function(contact) { %>
                                <option value="<%= contact.contact_id %>"><%= contact.first_name %> <%= contact.last_name %></option>
                            <% }); %>
                        <% } else { %>
                            <option value="">No contacts available</option>
                        <% } %>
                    </select>
                    <small class="form-hint">Hold Ctrl/Cmd to select multiple contacts</small>
                </div>

                <div class="form-group">
                    <label for="event-notes">Notes (Optional)</label>
                    <textarea id="event-notes" name="notes" rows="3" placeholder="Add any additional details..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-outline" onclick="closeEventModal()">Cancel</button>
                    <button type="submit" class="btn-primary" id="event-submit-btn">Save Event</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Calendar state from server
        let currentYear = <%= currentYear %>;
        let currentMonth = <%= currentMonth %>;
        let currentDay = <%= currentDay %>;
        let currentView = '<%= currentView %>';
        const todayData = {
            year: <%= today.year %>,
            month: <%= today.month %>,
            day: <%= today.day %>
        };

        // Events data from server
        const eventsData = <%- JSON.stringify(events || []) %>;

        // Build events map by date
        const eventsByDate = {};
        eventsData.forEach(event => {
            const dateKey = event.event_date.split('T')[0];
            if (!eventsByDate[dateKey]) {
                eventsByDate[dateKey] = [];
            }
            eventsByDate[dateKey].push(event);
        });

        // Generate calendar based on current view
        function generateCalendar() {
            if (currentView === 'month') {
                generateMonthView();
            } else if (currentView === 'week') {
                generateWeekView();
            } else if (currentView === 'day') {
                generateDayView();
            }
        }

        function generateMonthView() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('current-month').textContent = `${monthNames[currentMonth - 1]} ${currentYear}`;

            const firstDay = new Date(currentYear, currentMonth - 1, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth, 0).getDate();
            const daysInPrevMonth = new Date(currentYear, currentMonth - 1, 0).getDate();

            const calendarDays = document.getElementById('calendar-days');
            calendarDays.innerHTML = '';

            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const prevMonth = currentMonth === 1 ? 12 : currentMonth - 1;
                const prevYear = currentMonth === 1 ? currentYear - 1 : currentYear;
                const dayDiv = createDayCell(day, prevYear, prevMonth, 'other-month');
                calendarDays.appendChild(dayDiv);
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = day === todayData.day &&
                               currentMonth === todayData.month &&
                               currentYear === todayData.year;
                const dayDiv = createDayCell(day, currentYear, currentMonth, isToday ? 'today' : 'current-month');
                calendarDays.appendChild(dayDiv);
            }

            // Next month days
            const totalCells = calendarDays.children.length;
            const remainingCells = 42 - totalCells;
            for (let day = 1; day <= remainingCells; day++) {
                const nextMonth = currentMonth === 12 ? 1 : currentMonth + 1;
                const nextYear = currentMonth === 12 ? currentYear + 1 : currentYear;
                const dayDiv = createDayCell(day, nextYear, nextMonth, 'other-month');
                calendarDays.appendChild(dayDiv);
            }
        }

        function createDayCell(day, year, month, className) {
            const dayDiv = document.createElement('div');
            dayDiv.className = `calendar-day ${className}`;

            const dateKey = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const dayEvents = eventsByDate[dateKey] || [];

            let eventsHtml = '';
            dayEvents.slice(0, 3).forEach(event => {
                const typeClass = event.event_type ? event.event_type.toLowerCase() : 'spiritual';
                eventsHtml += `<div class="mini-event ${typeClass}" onclick="editEvent(${event.event_id}); event.stopPropagation();">${event.title}</div>`;
            });
            if (dayEvents.length > 3) {
                eventsHtml += `<div class="mini-event more">+${dayEvents.length - 3} more</div>`;
            }

            dayDiv.innerHTML = `
                <div class="day-number">${day}</div>
                <div class="day-events" data-date="${dateKey}" ondrop="dropEvent(event)" ondragover="allowDrop(event)">
                    ${eventsHtml}
                </div>
            `;
            dayDiv.addEventListener('click', () => showDayEvents(year, month, day));
            return dayDiv;
        }

        function generateWeekView() {
            // Calculate week start date
            const selectedDate = new Date(currentYear, currentMonth - 1, currentDay);
            const dayOfWeek = selectedDate.getDay();
            const weekStart = new Date(selectedDate);
            weekStart.setDate(selectedDate.getDate() - dayOfWeek);

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('current-month').textContent = `Week of ${monthNames[weekStart.getMonth()]} ${weekStart.getDate()}, ${weekStart.getFullYear()}`;

            // Update week day headers and events
            const columns = document.querySelectorAll('.week-day-column');
            columns.forEach((col, i) => {
                const colDate = new Date(weekStart);
                colDate.setDate(weekStart.getDate() + i);
                const dateKey = colDate.toISOString().split('T')[0];

                const header = col.querySelector('.week-day-header');
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                header.textContent = `${dayNames[i]} ${colDate.getDate()}`;

                const eventsContainer = col.querySelector('.week-day-events');
                eventsContainer.innerHTML = '';
                eventsContainer.dataset.date = dateKey;

                const dayEvents = eventsByDate[dateKey] || [];
                dayEvents.forEach(event => {
                    const typeClass = event.event_type ? event.event_type.toLowerCase() : 'spiritual';
                    const startTime = event.start_time ? event.start_time.substring(0, 5) : '';
                    eventsContainer.innerHTML += `
                        <div class="week-event ${typeClass}" onclick="editEvent(${event.event_id})" draggable="true" ondragstart="dragEvent(event)" data-event-id="${event.event_id}">
                            <span class="week-event-time">${startTime}</span>
                            <span class="week-event-title">${event.title}</span>
                        </div>
                    `;
                });
            });
        }

        function generateDayView() {
            const dateStr = `${currentYear}-${String(currentMonth).padStart(2, '0')}-${String(currentDay).padStart(2, '0')}`;
            const date = new Date(currentYear, currentMonth - 1, currentDay);
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

            document.getElementById('current-month').textContent = `${dayNames[date.getDay()]}, ${monthNames[currentMonth - 1]} ${currentDay}, ${currentYear}`;
            document.getElementById('day-view-date').textContent = `${dayNames[date.getDay()]}, ${monthNames[currentMonth - 1]} ${currentDay}`;

            // Clear existing events
            document.querySelectorAll('.day-hour-events').forEach(el => {
                el.innerHTML = '';
                el.dataset.date = dateStr;
            });

            // Place events in time slots
            const dayEvents = eventsByDate[dateStr] || [];
            dayEvents.forEach(event => {
                if (event.start_time) {
                    const hour = parseInt(event.start_time.substring(0, 2));
                    const container = document.querySelector(`.day-hour-events[data-hour="${hour}"]`);
                    if (container) {
                        const typeClass = event.event_type ? event.event_type.toLowerCase() : 'spiritual';
                        container.innerHTML += `
                            <div class="day-event ${typeClass}" onclick="editEvent(${event.event_id})" draggable="true" ondragstart="dragEvent(event)" data-event-id="${event.event_id}">
                                <span class="day-event-time">${event.start_time.substring(0, 5)}</span>
                                <span class="day-event-title">${event.title}</span>
                            </div>
                        `;
                    }
                }
            });
        }

        function switchView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.view-btn[data-view="${view}"]`).classList.add('active');

            document.getElementById('month-view').style.display = view === 'month' ? '' : 'none';
            document.getElementById('week-view').style.display = view === 'week' ? '' : 'none';
            document.getElementById('day-view').style.display = view === 'day' ? '' : 'none';

            generateCalendar();
        }

        function navigatePrevious() {
            if (currentView === 'month') {
                currentMonth--;
                if (currentMonth < 1) {
                    currentMonth = 12;
                    currentYear--;
                }
            } else if (currentView === 'week') {
                const date = new Date(currentYear, currentMonth - 1, currentDay);
                date.setDate(date.getDate() - 7);
                currentYear = date.getFullYear();
                currentMonth = date.getMonth() + 1;
                currentDay = date.getDate();
            } else if (currentView === 'day') {
                const date = new Date(currentYear, currentMonth - 1, currentDay);
                date.setDate(date.getDate() - 1);
                currentYear = date.getFullYear();
                currentMonth = date.getMonth() + 1;
                currentDay = date.getDate();
            }
            // Reload page with new date to fetch new events
            window.location.href = `/calendar?year=${currentYear}&month=${currentMonth}&day=${currentDay}&view=${currentView}`;
        }

        function navigateNext() {
            if (currentView === 'month') {
                currentMonth++;
                if (currentMonth > 12) {
                    currentMonth = 1;
                    currentYear++;
                }
            } else if (currentView === 'week') {
                const date = new Date(currentYear, currentMonth - 1, currentDay);
                date.setDate(date.getDate() + 7);
                currentYear = date.getFullYear();
                currentMonth = date.getMonth() + 1;
                currentDay = date.getDate();
            } else if (currentView === 'day') {
                const date = new Date(currentYear, currentMonth - 1, currentDay);
                date.setDate(date.getDate() + 1);
                currentYear = date.getFullYear();
                currentMonth = date.getMonth() + 1;
                currentDay = date.getDate();
            }
            window.location.href = `/calendar?year=${currentYear}&month=${currentMonth}&day=${currentDay}&view=${currentView}`;
        }

        function goToToday() {
            window.location.href = `/calendar?year=${todayData.year}&month=${todayData.month}&day=${todayData.day}&view=${currentView}`;
        }

        function showDayEvents(year, month, day) {
            // Switch to day view for this date
            window.location.href = `/calendar?year=${year}&month=${month}&day=${day}&view=day`;
        }

        // Drag and drop
        let draggedEventId = null;

        function dragEvent(e) {
            draggedEventId = e.target.dataset.eventId;
            e.target.style.opacity = '0.5';
        }

        function allowDrop(e) {
            e.preventDefault();
            e.currentTarget.style.backgroundColor = 'rgba(46, 192, 249, 0.1)';
        }

        async function dropEvent(e) {
            e.preventDefault();
            e.currentTarget.style.backgroundColor = '';
            if (draggedEventId) {
                const newDate = e.currentTarget.dataset.date;
                if (newDate) {
                    try {
                        const response = await fetch(`/calendar/move/${draggedEventId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ newDate })
                        });
                        const result = await response.json();
                        if (result.success) {
                            window.location.reload();
                        } else {
                            alert('Error moving event: ' + (result.error || 'Unknown error'));
                        }
                    } catch (err) {
                        alert('Error moving event');
                    }
                }
                draggedEventId = null;
            }
        }

        function dropEventWeek(e, dayIndex) {
            dropEvent(e);
        }

        function dropEventDay(e, hour) {
            dropEvent(e);
        }

        document.addEventListener('dragend', (e) => {
            if (e.target.classList.contains('schedule-event') || e.target.classList.contains('week-event') || e.target.classList.contains('day-event')) {
                e.target.style.opacity = '1';
            }
        });

        document.addEventListener('dragleave', (e) => {
            if (e.target.classList.contains('day-events') || e.target.classList.contains('week-day-events') || e.target.classList.contains('day-hour-events')) {
                e.target.style.backgroundColor = '';
            }
        });

        // Event modal functions
        function openAddEventModal() {
            document.getElementById('event-modal').style.display = 'flex';
            document.getElementById('event-modal-title').textContent = 'Add New Event';
            document.getElementById('event-form').action = '/calendar/create';
            document.getElementById('event-form').reset();
            document.getElementById('event-id').value = '';
            document.getElementById('event-submit-btn').textContent = 'Save Event';
            // Set today as default date
            const today = new Date();
            document.getElementById('event-date').value = today.toISOString().split('T')[0];
        }

        function closeEventModal() {
            document.getElementById('event-modal').style.display = 'none';
        }

        async function editEvent(eventId) {
            try {
                const response = await fetch(`/calendar/${eventId}`);
                const data = await response.json();

                if (data.error) {
                    alert('Error loading event: ' + data.error);
                    return;
                }

                const event = data.event;

                // Update form for editing
                document.getElementById('event-modal').style.display = 'flex';
                document.getElementById('event-modal-title').textContent = 'Edit Event';
                document.getElementById('event-form').action = `/calendar/update/${eventId}`;
                document.getElementById('event-id').value = eventId;
                document.getElementById('event-submit-btn').textContent = 'Update Event';

                // Populate form fields
                document.getElementById('event-title').value = event.title || '';
                document.getElementById('event-type').value = event.event_type || '';
                document.getElementById('event-date').value = event.event_date ? event.event_date.split('T')[0] : '';
                document.getElementById('event-start-time').value = event.start_time ? event.start_time.substring(0, 5) : '';
                document.getElementById('event-end-time').value = event.end_time ? event.end_time.substring(0, 5) : '';
                document.getElementById('event-location').value = event.location || '';
                document.getElementById('event-notes').value = event.notes || '';

                // Set selected contacts
                const contactSelect = document.getElementById('event-contacts');
                if (event.contact_ids && event.contact_ids.length > 0) {
                    Array.from(contactSelect.options).forEach(option => {
                        option.selected = event.contact_ids.includes(parseInt(option.value));
                    });
                }
            } catch (err) {
                alert('Error loading event');
                console.error(err);
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('event-modal');
            if (event.target === modal) {
                closeEventModal();
            }
        }

        // User dropdown toggle
        const userMenu = document.querySelector('.user-menu');
        if (userMenu) {
            userMenu.addEventListener('click', function(e) {
                this.querySelector('.user-dropdown').classList.toggle('show');
            });
        }

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-menu')) {
                document.querySelectorAll('.user-dropdown').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
            }
        });

        // Initialize calendar on page load
        generateCalendar();
    </script>

    <style>
        /* Week View Styles */
        .week-grid {
            display: flex;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            min-height: 600px;
        }
        .week-time-column {
            width: 60px;
            flex-shrink: 0;
            background: #f5f5f5;
        }
        .week-header-spacer {
            height: 40px;
            border-bottom: 1px solid #ddd;
        }
        .time-slot {
            height: 40px;
            padding: 4px;
            font-size: 11px;
            color: #666;
            border-bottom: 1px solid #eee;
        }
        .week-day-column {
            flex: 1;
            border-left: 1px solid #ddd;
        }
        .week-day-header {
            height: 40px;
            padding: 8px;
            text-align: center;
            font-weight: 600;
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }
        .week-day-events {
            padding: 4px;
            min-height: 560px;
        }
        .week-event {
            padding: 4px 8px;
            margin-bottom: 4px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        .week-event-time {
            font-weight: 600;
            margin-right: 4px;
        }

        /* Day View Styles */
        .day-grid {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .day-header-info {
            padding: 16px;
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }
        .day-header-info h3 {
            margin: 0;
        }
        .day-hour-row {
            display: flex;
            border-bottom: 1px solid #eee;
        }
        .day-hour-label {
            width: 60px;
            padding: 8px;
            font-size: 12px;
            color: #666;
            background: #f9f9f9;
            flex-shrink: 0;
        }
        .day-hour-events {
            flex: 1;
            padding: 4px;
            min-height: 50px;
        }
        .day-event {
            padding: 8px;
            margin-bottom: 4px;
            border-radius: 4px;
            cursor: pointer;
        }
        .day-event-time {
            font-weight: 600;
            margin-right: 8px;
        }

        /* Event type colors */
        .week-event.spiritual, .day-event.spiritual { background: #e8f0fe; border-left: 3px solid #4285f4; }
        .week-event.social, .day-event.social { background: #fef3e8; border-left: 3px solid #f5a623; }
        .week-event.intellectual, .day-event.intellectual { background: #e8f5e9; border-left: 3px solid #34a853; }
        .week-event.physical, .day-event.physical { background: #fce8e8; border-left: 3px solid #ea4335; }
        .week-event.romantic, .day-event.romantic { background: #f3e8fe; border-left: 3px solid #9c27b0; }
    </style>
</body>
</html>
