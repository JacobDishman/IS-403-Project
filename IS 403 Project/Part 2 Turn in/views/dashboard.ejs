<%- include('partials/header', {pageTitle: 'Goals Dashboard - Cal-Endure to the End'}) %>
<body class="app-page">
    <%- include('partials/app-navbar', {currentPage: 'dashboard'}) %>

    <!-- Main Content -->
    <main class="app-main">
        <div class="app-container">
            <!-- Page Header -->
            <header class="page-header">
                <div>
                    <h1 class="page-title">Your Goals</h1>
                    <p class="page-subtitle">Track your progress across all areas of life</p>
                </div>
                <div class="header-actions">
                    <button class="btn-primary" onclick="openAddGoalModal()">
                        <span>+ Add Goal</span>
                    </button>
                </div>
            </header>

            <!-- Goals Overview Stats -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-info">
                        <div class="stat-value" id="total-goals"><%= typeof stats !== 'undefined' ? stats.total : '12' %></div>
                        <div class="stat-label">Total Goals</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-info">
                        <div class="stat-value" id="completed-goals"><%= typeof stats !== 'undefined' ? stats.completed : '5' %></div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-info">
                        <div class="stat-value" id="active-goals"><%= typeof stats !== 'undefined' ? stats.active : '7' %></div>
                        <div class="stat-label">In Progress</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-info">
                        <div class="stat-value" id="events-today"><%= typeof stats !== 'undefined' ? stats.eventsToday : '3' %></div>
                        <div class="stat-label">Events Today</div>
                    </div>
                </div>
            </div>

            <!-- Goals Categories Grid -->
            <div class="goals-grid">
                <!-- Spiritual Goals -->
                <div class="goal-category spiritual">
                    <div class="category-header">
                        <div class="category-icon">‚úùÔ∏è</div>
                        <h2 class="category-title">Spiritual</h2>
                        <button class="btn-icon" onclick="addGoalToCategory('spiritual')">+</button>
                    </div>
                    <div class="category-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: <%= typeof progress !== 'undefined' && progress.spiritual ? progress.spiritual + '%' : '70%' %>"></div>
                        </div>
                        <span class="progress-text"><%= typeof progress !== 'undefined' && progress.spiritual ? progress.spiritual : '70' %>% Complete</span>
                    </div>
                    <div class="goals-list" id="spiritual-goals">
                        <% if (typeof goals !== 'undefined' && goals.spiritual) { %>
                            <% goals.spiritual.forEach(function(goal) { %>
                                <div class="goal-item <%= goal.completed ? 'completed' : '' %>">
                                    <div class="goal-checkbox">
                                        <input type="checkbox" id="goal-<%= goal.goal_id %>" <%= goal.completed ? 'checked' : '' %>>
                                        <label for="goal-<%= goal.goal_id %>"></label>
                                    </div>
                                    <div class="goal-content">
                                        <div class="goal-title"><%= goal.title %></div>
                                        <div class="goal-meta">
                                            <span class="goal-events"><%= goal.event_count || 0 %> events</span>
                                        </div>
                                    </div>
                                    <button class="btn-icon-small" onclick="editGoal('<%= goal.goal_id %>')">‚úèÔ∏è</button>
                                    <button class="btn-icon-small" onclick="deleteGoal('<%= goal.goal_id %>')">üóëÔ∏è</button>
                                </div>
                            <% }); %>
                        <% } else { %>
                            <div class="goal-item">
                                <div class="goal-checkbox">
                                    <input type="checkbox" id="spiritual-1">
                                    <label for="spiritual-1"></label>
                                </div>
                                <div class="goal-content">
                                    <div class="goal-title">Read scriptures daily</div>
                                    <div class="goal-meta">
                                        <span class="goal-events">5 events this week</span>
                                    </div>
                                </div>
                                <button class="btn-icon-small" onclick="editGoal('spiritual-1')">‚úèÔ∏è</button>
                                <button class="btn-icon-small" onclick="deleteGoal('spiritual-1')">üóëÔ∏è</button>
                            </div>
                            <div class="goal-item">
                                <div class="goal-checkbox">
                                    <input type="checkbox" id="spiritual-2">
                                    <label for="spiritual-2"></label>
                                </div>
                                <div class="goal-content">
                                    <div class="goal-title">Attend temple monthly</div>
                                    <div class="goal-meta">
                                        <span class="goal-events">1 event scheduled</span>
                                    </div>
                                </div>
                                <button class="btn-icon-small" onclick="editGoal('spiritual-2')">‚úèÔ∏è</button>
                                <button class="btn-icon-small" onclick="deleteGoal('spiritual-2')">üóëÔ∏è</button>
                            </div>
                        <% } %>
                    </div>
                </div>

                <!-- Social Goals -->
                <div class="goal-category social">
                    <div class="category-header">
                        <div class="category-icon">üë•</div>
                        <h2 class="category-title">Social</h2>
                        <button class="btn-icon" onclick="addGoalToCategory('social')">+</button>
                    </div>
                    <div class="category-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 50%"></div>
                        </div>
                        <span class="progress-text">50% Complete</span>
                    </div>
                    <div class="goals-list" id="social-goals">
                        <div class="goal-item">
                            <div class="goal-checkbox">
                                <input type="checkbox" id="social-1">
                                <label for="social-1"></label>
                            </div>
                            <div class="goal-content">
                                <div class="goal-title">Weekly family dinner</div>
                                <div class="goal-meta">
                                    <span class="goal-events">4 events this month</span>
                                </div>
                            </div>
                            <button class="btn-icon-small" onclick="editGoal('social-1')">‚úèÔ∏è</button>
                            <button class="btn-icon-small" onclick="deleteGoal('social-1')">üóëÔ∏è</button>
                        </div>
                        <div class="goal-item">
                            <div class="goal-checkbox">
                                <input type="checkbox" id="social-2">
                                <label for="social-2"></label>
                            </div>
                            <div class="goal-content">
                                <div class="goal-title">Connect with mission friends</div>
                                <div class="goal-meta">
                                    <span class="goal-events">2 events scheduled</span>
                                </div>
                            </div>
                            <button class="btn-icon-small" onclick="editGoal('social-2')">‚úèÔ∏è</button>
                            <button class="btn-icon-small" onclick="deleteGoal('social-2')">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>

                <!-- Intellectual Goals -->
                <div class="goal-category intellectual">
                    <div class="category-header">
                        <div class="category-icon">üìö</div>
                        <h2 class="category-title">Intellectual</h2>
                        <button class="btn-icon" onclick="addGoalToCategory('intellectual')">+</button>
                    </div>
                    <div class="category-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 85%"></div>
                        </div>
                        <span class="progress-text">85% Complete</span>
                    </div>
                    <div class="goals-list" id="intellectual-goals">
                        <div class="goal-item completed">
                            <div class="goal-checkbox">
                                <input type="checkbox" id="intellectual-1" checked>
                                <label for="intellectual-1"></label>
                            </div>
                            <div class="goal-content">
                                <div class="goal-title">Complete IS 403 project</div>
                                <div class="goal-meta">
                                    <span class="goal-events">Project completed! üéâ</span>
                                </div>
                            </div>
                            <button class="btn-icon-small" onclick="editGoal('intellectual-1')">‚úèÔ∏è</button>
                            <button class="btn-icon-small" onclick="deleteGoal('intellectual-1')">üóëÔ∏è</button>
                        </div>
                        <div class="goal-item">
                            <div class="goal-checkbox">
                                <input type="checkbox" id="intellectual-2">
                                <label for="intellectual-2"></label>
                            </div>
                            <div class="goal-content">
                                <div class="goal-title">Read one book per month</div>
                                <div class="goal-meta">
                                    <span class="goal-events">In progress...</span>
                                </div>
                            </div>
                            <button class="btn-icon-small" onclick="editGoal('intellectual-2')">‚úèÔ∏è</button>
                            <button class="btn-icon-small" onclick="deleteGoal('intellectual-2')">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>

                <!-- Physical Goals -->
                <div class="goal-category physical">
                    <div class="category-header">
                        <div class="category-icon">üí™</div>
                        <h2 class="category-title">Physical</h2>
                        <button class="btn-icon" onclick="addGoalToCategory('physical')">+</button>
                    </div>
                    <div class="category-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%"></div>
                        </div>
                        <span class="progress-text">60% Complete</span>
                    </div>
                    <div class="goals-list" id="physical-goals">
                        <div class="goal-item">
                            <div class="goal-checkbox">
                                <input type="checkbox" id="physical-1">
                                <label for="physical-1"></label>
                            </div>
                            <div class="goal-content">
                                <div class="goal-title">Exercise 5 times per week</div>
                                <div class="goal-meta">
                                    <span class="goal-events">3 workouts this week</span>
                                </div>
                            </div>
                            <button class="btn-icon-small" onclick="editGoal('physical-1')">‚úèÔ∏è</button>
                            <button class="btn-icon-small" onclick="deleteGoal('physical-1')">üóëÔ∏è</button>
                        </div>
                        <div class="goal-item">
                            <div class="goal-checkbox">
                                <input type="checkbox" id="physical-2">
                                <label for="physical-2"></label>
                            </div>
                            <div class="goal-content">
                                <div class="goal-title">Sleep 8 hours per night</div>
                                <div class="goal-meta">
                                    <span class="goal-events">Track daily</span>
                                </div>
                            </div>
                            <button class="btn-icon-small" onclick="editGoal('physical-2')">‚úèÔ∏è</button>
                            <button class="btn-icon-small" onclick="deleteGoal('physical-2')">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>

                <!-- Romantic Goals -->
                <div class="goal-category romantic">
                    <div class="category-header">
                        <div class="category-icon">‚ù§Ô∏è</div>
                        <h2 class="category-title">Romantic</h2>
                        <button class="btn-icon" onclick="addGoalToCategory('romantic')">+</button>
                    </div>
                    <div class="category-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 40%"></div>
                        </div>
                        <span class="progress-text">40% Complete</span>
                    </div>
                    <div class="goals-list" id="romantic-goals">
                        <div class="goal-item">
                            <div class="goal-checkbox">
                                <input type="checkbox" id="romantic-1">
                                <label for="romantic-1"></label>
                            </div>
                            <div class="goal-content">
                                <div class="goal-title">Go on two dates per month</div>
                                <div class="goal-meta">
                                    <span class="goal-events">1 date scheduled</span>
                                </div>
                            </div>
                            <button class="btn-icon-small" onclick="editGoal('romantic-1')">‚úèÔ∏è</button>
                            <button class="btn-icon-small" onclick="deleteGoal('romantic-1')">üóëÔ∏è</button>
                        </div>
                        <div class="goal-item">
                            <div class="goal-checkbox">
                                <input type="checkbox" id="romantic-2">
                                <label for="romantic-2"></label>
                            </div>
                            <div class="goal-content">
                                <div class="goal-title">Attend social events</div>
                                <div class="goal-meta">
                                    <span class="goal-events">FHE next Monday</span>
                                </div>
                            </div>
                            <button class="btn-icon-small" onclick="editGoal('romantic-2')">‚úèÔ∏è</button>
                            <button class="btn-icon-small" onclick="deleteGoal('romantic-2')">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add/Edit Goal Modal -->
    <div id="goal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add New Goal</h2>
                <button class="modal-close" onclick="closeGoalModal()">&times;</button>
            </div>
            <form id="goal-form" class="modal-form" action="/goals" method="POST">
                <div class="form-group">
                    <label for="goal-category-select">Category</label>
                    <select id="goal-category-select" name="category" required>
                        <option value="">Select category...</option>
                        <option value="spiritual">‚úùÔ∏è Spiritual</option>
                        <option value="social">üë• Social</option>
                        <option value="intellectual">üìö Intellectual</option>
                        <option value="physical">üí™ Physical</option>
                        <option value="romantic">‚ù§Ô∏è Romantic</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="goal-title">Goal Title</label>
                    <input type="text" id="goal-title" name="title" placeholder="What do you want to achieve?" required>
                </div>
                <div class="form-group">
                    <label for="goal-description">Description (Optional)</label>
                    <textarea id="goal-description" name="description" rows="3" placeholder="Add more details about this goal..."></textarea>
                </div>
                <div class="form-group">
                    <label for="goal-target">Target Frequency</label>
                    <input type="text" id="goal-target" name="target" placeholder="e.g., 3 times per week, daily, monthly">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-outline" onclick="closeGoalModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Goal</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Modal functions
        function openAddGoalModal(category = '') {
            document.getElementById('goal-modal').style.display = 'flex';
            document.getElementById('modal-title').textContent = 'Add New Goal';
            document.getElementById('goal-form').reset();
            if (category) {
                document.getElementById('goal-category-select').value = category;
            }
        }

        function addGoalToCategory(category) {
            openAddGoalModal(category);
        }

        function closeGoalModal() {
            document.getElementById('goal-modal').style.display = 'none';
        }

        function editGoal(goalId) {
            openAddGoalModal();
            document.getElementById('modal-title').textContent = 'Edit Goal';
            // In real implementation, load goal data here
        }

        function deleteGoal(goalId) {
            if (confirm('Are you sure you want to delete this goal?')) {
                // In real implementation, delete from database
                window.location.href = '/goals/delete/' + goalId;
            }
        }

        // Form submission
        document.getElementById('goal-form').addEventListener('submit', function(e) {
            // Form will submit normally to the server
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('goal-modal');
            if (event.target === modal) {
                closeGoalModal();
            }
        }
    </script>
</body>
</html>
